---
title: "Nominate"
output: html_document
date: "2025-03-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
help(package=dwnominate)
```
```{r}
install.packages('dplyr')
install.packages('pscl')
install.packages("wnominate")
install.packages('remotes')
remotes::install_github('wmay/dwnominate')
```




```{r}

library('wnominate')
library('dwnominate')
```


```{r}
con118 <- read.csv("congress118_matrix_with_ids.csv", header=FALSE)
con117 <- read.csv("congress117_matrix_with_ids.csv", header=FALSE)
con116 <- read.csv("congress116_matrix_with_ids.csv", header=FALSE)
con115 <- read.csv("congress115_matrix_with_ids.csv", header=FALSE)
con114 <- read.csv("congress114_matrix_with_ids.csv", header=FALSE)
con113 <- read.csv("congress113_matrix_with_ids.csv", header=FALSE)
```




```{r}

# Extract IDs (first column) and voting data (remaining columns)
con118_ids <- con118[, 1]
con118_votes <- as.matrix(con118[, -1])

con117_ids <- con117[, 1]
con117_votes <- as.matrix(con117[, -1])

con116_ids <- con116[, 1]
con116_votes <- as.matrix(con116[, -1])

con115_ids <- con115[, 1]
con115_votes <- as.matrix(con115[, -1])

con114_ids <- con114[, 1]
con114_votes <- as.matrix(con114[, -1])

con113_ids <- con113[, 1]
con113_votes <- as.matrix(con113[, -1])

# Create a unified set of all legislators across all congresses
all_ids <- unique(c(con118_ids,con117_ids, con116_ids, con115_ids, con114_ids, con113_ids))

# Function to align a congress matrix to the unified ID list
align_matrix <- function(ids, votes, all_ids) {
  aligned_matrix <- matrix(0, nrow=length(all_ids), ncol=ncol(votes))  # 0 for missing
  match_indices <- match(ids, all_ids)
  for (i in 1:length(ids)) {
    aligned_matrix[match_indices[i], ] <- votes[i, ]
  }
  return(aligned_matrix)
}

# Align all congress matrices
aligned_con118 <- align_matrix(con118_ids, con118_votes, all_ids)
aligned_con117 <- align_matrix(con117_ids, con117_votes, all_ids)
aligned_con116 <- align_matrix(con116_ids, con116_votes, all_ids)
aligned_con115 <- align_matrix(con115_ids, con115_votes, all_ids)
aligned_con114 <- align_matrix(con114_ids, con114_votes, all_ids)
aligned_con113 <- align_matrix(con113_ids, con113_votes, all_ids)



```

```{r}
# First, let's check the dimensions of the original data
cat("Original dimensions:\n")
cat("con118:", dim(con118_votes), "\n")
cat("con117:", dim(con117_votes), "\n")
cat("con116:", dim(con116_votes), "\n")
cat("con115:", dim(con115_votes), "\n")
cat("con114:", dim(con114_votes), "\n")
cat("con113:", dim(con113_votes), "\n")

# Check how many unique IDs we have
cat("Number of unique IDs:", length(all_ids), "\n")

# Let's check the dimensions after alignment
cat("Aligned dimensions:\n")
cat("aligned_con118:", dim(aligned_con118), "\n")
cat("aligned_con117:", dim(aligned_con117), "\n")
cat("aligned_con116:", dim(aligned_con116), "\n")
cat("aligned_con115:", dim(aligned_con115), "\n")
cat("aligned_con114:", dim(aligned_con114), "\n")
cat("aligned_con113:", dim(aligned_con113), "\n")
```



```{r}
# After filtering out legislators with few votes, let's add party information

# Create a simple party vector (this is a placeholder - you might want to add real party data)
# We'll assign party 1 to all legislators for now
party_data <- data.frame(
  id = filtered_ids,
  party = rep(1, length(filtered_ids))
)


```



```{r}
# Get the legislator coordinates
legislator_coords <- results$legislators

# 1. Correlation between dimensions
# Check if the two dimensions are correlated with each other
dim_correlation <- cor(legislator_coords$coord1D, legislator_coords$coord2D)
print("Correlation between dimension 1 and dimension 2:")
print(dim_correlation)


```
```{r}

legislator_mapping <- data.frame(
  numeric_id = 1:length(top_legislators),
  original_id = top_legislators
)
head(legislator_mapping)
```
```{r}
write.csv(results$legislators, "dwnominate_results.csv", row.names = FALSE)
write.csv(legislator_mapping, "legislator_id_mapping.csv", row.names = FALSE)

```

```{r}
# Select only the legislators from Congress 117
con117_legislators <- con117_ids
cat("Number of legislators in Congress 117:", length(con117_legislators), "\n")

# If there are more than 450, take only the first 450
if (length(con117_legislators) > 450) {
  con117_legislators <- con117_legislators[1:450]
}

# Re-align matrices with only these legislators
aligned_con117_only <- align_matrix_fixed(con117_ids, con117_votes, con117_legislators)
aligned_con116_only <- align_matrix_fixed(con116_ids, con116_votes, con117_legislators)
aligned_con115_only <- align_matrix_fixed(con115_ids, con115_votes, con117_legislators)
aligned_con114_only <- align_matrix_fixed(con114_ids, con114_votes, con117_legislators)
aligned_con113_only <- align_matrix_fixed(con113_ids, con113_votes, con117_legislators)

# Create legis.data with party info
legis_data <- data.frame(
  id = con117_legislators,
  party = rep(1, length(con117_legislators))  # Placeholder for party
)
rownames(legis_data) <- 1:nrow(legis_data)

# Create rollcall objects with only the Congress 117 legislators
rc_con117_only <- list(
  rollcall(aligned_con117_only, yea=c(1), nay=c(2), missing=c(0), legis.data=legis_data, desc="Congress 117"),
  rollcall(aligned_con116_only, yea=c(1), nay=c(2), missing=c(0), legis.data=legis_data, desc="Congress 116"),
  rollcall(aligned_con115_only, yea=c(1), nay=c(2), missing=c(0), legis.data=legis_data, desc="Congress 115"),
  rollcall(aligned_con114_only, yea=c(1), nay=c(2), missing=c(0), legis.data=legis_data, desc="Congress 114"),
  rollcall(aligned_con113_only, yea=c(1), nay=c(2), missing=c(0), legis.data=legis_data, desc="Congress 113")
)

# Run DW-NOMINATE with only the Congress 117 legislators
results_con117_only <- dwnominate(rc_con117_only, polarity=c(1,1), dims=2)

# Create a mapping of numeric IDs to original IDs
id_mapping_con117 <- data.frame(
  numeric_id = 1:length(con117_legislators),
  original_id = con117_legislators
)

# Save the mapping
write.csv(id_mapping_con117, "legislator_id_mapping_con117_only.csv", row.names = FALSE)

# Save the results
write.csv(results_con117_only$legislators, "dwnominate_con117_only_results.csv", row.names = FALSE)
```

